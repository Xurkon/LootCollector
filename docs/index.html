<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LootCollector - Performance Optimizations</title>
    <style>
        :root {
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --bg-tertiary: #21262d;
            --text-primary: #c9d1d9;
            --text-secondary: #8b949e;
            --accent: #58a6ff;
            --accent-orange: #e67e22;
            --border: #30363d;
            --code-bg: #1f2428;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans', Helvetica, Arial, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }

        .hero {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-primary) 100%);
            border-bottom: 1px solid var(--border);
            padding: 60px 20px;
            text-align: center;
        }

        .hero h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-orange) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero .subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .hero .badge {
            display: inline-block;
            background: var(--accent-orange);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            margin-top: 15px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .section {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .section h2 {
            color: var(--accent);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }

        .section h3 {
            color: var(--text-primary);
            margin: 20px 0 10px;
        }

        .optimization-card {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
        }

        .optimization-card h4 {
            color: var(--accent-orange);
            margin-bottom: 10px;
        }

        .optimization-card ul {
            list-style: none;
            padding: 0;
        }

        .optimization-card li {
            padding: 8px 0;
            padding-left: 20px;
            position: relative;
            color: var(--text-secondary);
        }

        .optimization-card li::before {
            content: 'âœ“';
            position: absolute;
            left: 0;
            color: #3fb950;
        }

        code {
            background: var(--code-bg);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
            font-size: 0.9em;
            color: var(--accent);
        }

        .file-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .file-item {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }

        .file-item .filename {
            color: var(--accent);
            font-family: monospace;
        }

        .file-item .desc {
            color: var(--text-secondary);
            font-size: 0.85rem;
            margin-top: 5px;
        }

        .modified-notice {
            background: linear-gradient(135deg, rgba(230, 126, 34, 0.1) 0%, rgba(88, 166, 255, 0.1) 100%);
            border: 1px solid var(--accent-orange);
            border-radius: 8px;
            padding: 20px;
            margin: 30px 0;
            text-align: center;
        }

        .modified-notice h3 {
            color: var(--accent-orange);
            margin-bottom: 10px;
        }

        .credit {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            margin-top: 30px;
        }

        .credit p {
            color: var(--text-secondary);
        }

        .credit a {
            color: var(--accent);
            text-decoration: none;
        }

        .credit a:hover {
            text-decoration: underline;
        }

        footer {
            text-align: center;
            padding: 30px;
            color: var(--text-secondary);
            border-top: 1px solid var(--border);
        }
    </style>
</head>

<body>
    <div class="hero">
        <h1>LootCollector</h1>
        <p class="subtitle">Performance Optimizations Documentation</p>
        <span class="badge">Modified by Xurkon</span>

        <div style="margin-top: 20px;">
            <a href="https://xurkon.github.io/LootCollector/"><img
                    src="https://img.shields.io/badge/ðŸ“–_Docs-GitHub_Pages-2ea44f?style=for-the-badge"
                    alt="Documentation"></a>
            <a href="https://github.com/Xurkon/LootCollector/tree/performance-tweaks"><img
                    src="https://img.shields.io/badge/GitHub-View_Source-gray?style=for-the-badge&logo=github"
                    alt="View Source"></a>
            <img src="https://img.shields.io/github/downloads/Xurkon/LootCollector/total?style=for-the-badge&label=TOTAL%20DOWNLOADS&color=e67e22"
                alt="Total Downloads">
            <img src="https://img.shields.io/github/downloads/Xurkon/LootCollector/latest/total?style=for-the-badge&label=LATEST%20RELEASE&color=3498db"
                alt="Latest Release">
            <a href="https://patreon.com/Xurkon"><img
                    src="https://img.shields.io/badge/Patreon-Support-orange?style=for-the-badge&logo=patreon"
                    alt="Patreon"></a>
            <a href="https://www.paypal.com/cgi-bin/webscr?cmd=_donations&business=kancerous@gmail.com"><img
                    src="https://img.shields.io/badge/PayPal-Donate-blue?style=for-the-badge&logo=paypal"
                    alt="PayPal"></a>
        </div>
        <div style="margin-top: 10px;">
            <img src="https://img.shields.io/badge/version-v0.7.54-blue" alt="Version">
            <img src="https://img.shields.io/badge/WoW-3.3.5a-orange" alt="WoW Version">
            <img src="https://img.shields.io/badge/Project-Ascension-purple" alt="Project Ascension">
        </div>
    </div>

    <div class="container">
        <div class="modified-notice">
            <h3>âš¡ Modified Version</h3>
            <p>This version includes performance optimizations by <strong>Xurkon</strong> to reduce CPU usage and
                improve addon efficiency.</p>
        </div>

        <div class="section">
            <h2>Version 0.7.46 - Performance Optimizations Phase 3</h2>

            <div class="optimization-card">
                <h4>LootCollector.lua - String Interning</h4>
                <ul>
                    <li>Added <code>linkIntern</code> weak table with <code>__mode = "v"</code> for automatic GC of
                        unused strings</li>
                    <li>Added <code>LootCollector:InternLink(link)</code> function to deduplicate item link strings</li>
                    <li>Added <code>LootCollector:GetInternStats()</code> to return count of cached unique links</li>
                    <li>Applied to discovery record creation in Core.lua (lines 1934, 2058)</li>
                </ul>
            </div>

            <div class="optimization-card">
                <h4>Viewer.lua - Weak Table Caching</h4>
                <ul>
                    <li>Converted <code>Cache.itemInfo</code> to <code>setmetatable({}, {__mode = "v"})</code></li>
                    <li>Converted <code>Cache.characterClass</code> to <code>setmetatable({}, {__mode = "v"})</code>
                    </li>
                    <li>Converted <code>Cache.worldforged</code> to <code>setmetatable({}, {__mode = "v"})</code></li>
                    <li>Converted <code>Cache.zoneNames</code> to <code>setmetatable({}, {__mode = "v"})</code></li>
                    <li>Added <code>Viewer:IsWeakCachingActive()</code> method to verify metatable mode</li>
                </ul>
            </div>

            <div class="optimization-card">
                <h4>LootCollector.lua - Batch Processing with Coroutines</h4>
                <ul>
                    <li>Added <code>activeCoroutines</code> table to track running coroutines</li>
                    <li>Added <code>LootCollector:ProcessInChunks(items, processor, chunkSize, onComplete)</code></li>
                    <li>Uses <code>coroutine.create()</code> and <code>coroutine.yield()</code> for frame-spread
                        processing</li>
                    <li>Default chunk size: 50 items per frame</li>
                    <li>Creates OnUpdate frame that calls <code>coroutine.resume()</code> each frame</li>
                </ul>
            </div>

            <div class="optimization-card">
                <h4>Core.lua - New Slash Commands</h4>
                <ul>
                    <li><code>/lcstats</code> - Displays optimization status: string interning count, weak caching
                        active, total discoveries</li>
                    <li><code>/lcbench</code> - Benchmarks minimap pin performance: compares full iteration vs spatial
                        grid lookup (100 iterations)</li>
                </ul>
            </div>

            <h3>Technical Details</h3>
            <p>Weak tables with <code>__mode = "v"</code> allow values to be garbage collected when no other references
                exist.
                String interning shares identical string references across discoveries, reducing memory for duplicate
                item links.
                Coroutine-based batch processing prevents UI freezing by yielding after each chunk.
            </p>

            <h3>Implementation Notes</h3>
            <p><strong>Spatial Hashing:</strong> Successfully implemented for minimap optimization, achieving 93%
                reduction in pins processed (430 â†’ 47). This significantly improves performance in zones with many
                discoveries by only processing pins in the player's immediate vicinity.
            </p>
        </div>

        <div class="section">
            <h2>Version 0.7.43 - Performance Optimizations Phase 2</h2>

            <div class="optimization-card">
                <h4>Core.lua - New Performance Utilities</h4>
                <ul>
                    <li>Added <code>Core:AcquireTable()</code>/<code>ReleaseTable()</code> table pool to reduce GC
                        pressure</li>
                    <li>Added <code>Core:GetAdaptiveTimeBudget()</code> that adjusts processing time based on FPS
                        (1-5ms)</li>
                    <li>Added cached globals: <code>GetTime</code>, <code>GetFramerate</code>, <code>wipe</code>,
                        <code>tremove</code>, <code>debugprofilestop</code>
                    </li>
                </ul>
            </div>

            <div class="optimization-card">
                <h4>Toast.lua - Direct Table Assignment</h4>
                <ul>
                    <li>Replaced 5 <code>table.insert()</code> calls with <code>t[#t + 1] = v</code> pattern</li>
                    <li>Faster queue processing in spam detection and toast management</li>
                </ul>
            </div>

            <div class="optimization-card">
                <h4>Tooltip.lua - Localization + Direct Assignment</h4>
                <ul>
                    <li>Added localized globals: <code>pairs</code>, <code>ipairs</code>, <code>tonumber</code>,
                        <code>tostring</code>, <code>type</code>, <code>select</code>, <code>GetItemInfo</code>,
                        <code>GetItemStats</code>
                    </li>
                    <li>Replaced 11 <code>table.insert()</code> calls with direct assignment pattern</li>
                    <li>Faster upgrade chain building and tooltip rendering</li>
                </ul>
            </div>

            <h3>Technical Details</h3>
            <p>Direct table assignment (<code>t[#t + 1] = v</code>) is ~10-15% faster than
                <code>table.insert(t, v)</code> in Lua 5.1. The table pool prevents frequent garbage collection by
                reusing tables instead of creating new ones.
            </p>
        </div>

        <div class="section">
            <h2>Version 0.7.42 - Performance Optimizations Phase 1</h2>

            <div class="optimization-card">
                <h4>Toast.lua Optimizations</h4>
                <ul>
                    <li>Added global function caching for <code>GetTime</code>, <code>math.*</code>,
                        <code>table.*</code>, <code>string.*</code>
                    </li>
                    <li>Replaced per-call table creation in <code>checkQueueForSpam()</code> with reusable table</li>
                    <li>Dispatcher frame now hides when idle and auto-wakes when work is added</li>
                    <li>Reduces CPU usage when no toasts are pending</li>
                </ul>
            </div>

            <div class="optimization-card">
                <h4>Map.lua Optimizations</h4>
                <ul>
                    <li><code>updateTicker</code> frame hides when no data changes pending</li>
                    <li>Added <code>wakeDataChangeHandler()</code> helper function</li>
                    <li>Auto-wakes when <code>L.DataHasChanged</code> is set to true</li>
                </ul>
            </div>

            <div class="optimization-card">
                <h4>Core.lua & DBSync.lua</h4>
                <ul>
                    <li>Added wake calls at all <code>L.DataHasChanged = true</code> locations</li>
                    <li>Supports the new idle optimization pattern</li>
                </ul>
            </div>
        </div>

        <div class="section">
            <h2>Files Modified</h2>
            <div class="changelog-entry">
                <div class="version-header">
                    <span class="version-tag">v0.7.47.1</span>
                    <span class="date">January 17, 2026</span>
                </div>
                <h3>PvP Death Chest Fix</h3>
                <ul>
                    <li><strong>Blacklist Implemented:</strong> PvP loot containers ("Unclaimed Belongings", "Human
                        Corpse") are now ignored.</li>
                    <li><strong>False Positives:</strong> Fixed issue where player death chests created permanent world
                        pins.</li>
                </ul>
            </div>
            <div class="file-list">
                <div class="file-item">
                    <div class="filename">Toast.lua</div>
                    <div class="desc">Dispatcher idle/wake, global caching</div>
                </div>
                <div class="file-item">
                    <div class="filename">Map.lua</div>
                    <div class="desc">UpdateTicker idle/wake</div>
                </div>
                <div class="file-item">
                    <div class="filename">Core.lua</div>
                    <div class="desc">5 wake call additions</div>
                </div>
                <div class="file-item">
                    <div class="filename">DBSync.lua</div>
                    <div class="desc">1 wake call addition</div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>Technical Details</h2>
            <h3>OnUpdate Frame Optimization</h3>
            <p>The core optimization strategy is to hide frames with OnUpdate handlers when they have no work to do.
                This prevents the handler from being called every frame (~60 times/second) when idle.</p>

            <h3>Pattern Used</h3>
            <p>Frames start hidden and are shown (awakened) when work is added. When work completes, the frame hides
                itself again. This is done via:</p>
            <ul style="margin: 15px 0; padding-left: 20px; color: var(--text-secondary);">
                <li><code>frame:Hide()</code> when no work pending</li>
                <li><code>if dispatcher and not dispatcher:IsShown() then dispatcher:Show() end</code> when work is
                    added</li>
            </ul>
        </div>

        <div class="section">
            <h2>ðŸ§ª Testing & Verification</h2>
            <p style="margin-bottom: 20px; color: var(--text-secondary);">Use these in-game commands to verify the
                optimizations are working correctly.</p>

            <div class="optimization-card">
                <h4>Table Pool Verification</h4>
                <ul>
                    <li>Check if pool functions exist:</li>
                </ul>
                <pre
                    style="background: var(--code-bg); padding: 15px; border-radius: 6px; overflow-x: auto; margin: 10px 0;"><code>/script print(type(LootCollector:GetModule("Core").AcquireTable) == "function" and "Pool OK" or "Missing")</code></pre>
                <ul>
                    <li>Test table acquisition and release:</li>
                </ul>
                <pre
                    style="background: var(--code-bg); padding: 15px; border-radius: 6px; overflow-x: auto; margin: 10px 0;"><code>/script local C = LootCollector:GetModule("Core"); local t = C:AcquireTable(); t.test = 1; C:ReleaseTable(t); print("Pool cycle OK")</code></pre>
            </div>

            <div class="optimization-card">
                <h4>Adaptive Time Budget</h4>
                <ul>
                    <li>Check current budget based on FPS:</li>
                </ul>
                <pre
                    style="background: var(--code-bg); padding: 15px; border-radius: 6px; overflow-x: auto; margin: 10px 0;"><code>/script print("Budget: " .. LootCollector:GetModule("Core"):GetAdaptiveTimeBudget() .. "ms @ " .. floor(GetFramerate()) .. " FPS")</code></pre>
                <ul>
                    <li>Expected values: 1ms (&lt;20 FPS), 1.5ms (&lt;30), 2.5ms (&lt;45), 3.5ms (&lt;60), 5ms (â‰¥60)
                    </li>
                </ul>
            </div>

            <div class="optimization-card">
                <h4>FPS Monitoring</h4>
                <ul>
                    <li>Check current FPS:</li>
                </ul>
                <pre
                    style="background: var(--code-bg); padding: 15px; border-radius: 6px; overflow-x: auto; margin: 10px 0;"><code>/script print("FPS: " .. floor(GetFramerate()))</code></pre>
                <ul>
                    <li>Compare FPS in these scenarios before/after optimizations:
                        <ul style="margin-top: 8px;">
                            <li>Zone with many minimap pins visible</li>
                            <li>World Map open with 100+ discoveries</li>
                            <li>Receiving multiple discovery toasts rapidly</li>
                        </ul>
                    </li>
                </ul>
            </div>

            <div class="optimization-card">
                <h4>GC Pressure Test</h4>
                <ul>
                    <li>Measure garbage collection delta:</li>
                </ul>
                <pre
                    style="background: var(--code-bg); padding: 15px; border-radius: 6px; overflow-x: auto; margin: 10px 0;"><code>/script collectgarbage("collect"); local b = collectgarbage("count"); for i=1,1000 do local t = {} end; print(format("GC delta: %.2f KB", collectgarbage("count") - b))</code></pre>
            </div>

            <div class="optimization-card">
                <h4>Direct Assignment Timing</h4>
                <ul>
                    <li>Benchmark table.insert vs direct assignment:</li>
                </ul>
                <pre
                    style="background: var(--code-bg); padding: 15px; border-radius: 6px; overflow-x: auto; margin: 10px 0;"><code>/script local s = debugprofilestop(); for i=1,10000 do local t = {1,2,3}; t[#t+1] = 4 end; print(format("Direct: %.2f ms", debugprofilestop() - s))</code></pre>
            </div>

            <div class="optimization-card">
                <h4>Practical Testing Checklist</h4>
                <ul>
                    <li>Load addon and verify no Lua errors</li>
                    <li>Open/close World Map multiple times</li>
                    <li>Receive several discovery toasts</li>
                    <li>Open Viewer and scroll through items</li>
                    <li>Watch for FPS drops during heavy activity</li>
                    <li>Monitor for micro-stutters (reduced with table pool)</li>
                </ul>
            </div>

            <p style="margin-top: 20px; color: var(--text-secondary);"><strong>Note:</strong>
                <code>GetAddOnMemoryUsage()</code> returns 0 on Ascension 3.3.5a client due to disabled memory
                profiling. Use GC and FPS tests instead.
            </p>
        </div>

        <div class="section">
            <h2>Changelog</h2>

            <div class="optimization-card">
                <h4>v0.7.54 - Hide Collected Appearances Filter</h4>
                <ul>
                    <li>Added new <code>Hide Collected Appearances</code> filter to Hide Options submenu</li>
                    <li>Filters discoveries for items with appearances already in your wardrobe</li>
                    <li>Uses Ascension's <code>C_Appearance.GetItemAppearanceID</code> and
                        <code>C_AppearanceCollection.IsAppearanceCollected</code> APIs
                    </li>
                    <li>Includes 5-minute appearance cache for performance optimization</li>
                </ul>
            </div>

            <div class="optimization-card">
                <h4>v0.7.54 - Mystic Enchant Filter Fix</h4>
                <ul>
                    <li><strong>Problem:</strong> "Hide Looted" filter was flaky for Mystic Enchants because it relied
                        on scanning item tooltips for "Already Known" text, which often failed if the client hadn't
                        finished loading item data (returning empty tooltips).</li>
                    <li><strong>Solution:</strong> Switched to using the private
                        <code>C_MysticEnchant.QueryEnchants</code> API.
                    </li>
                    <li><strong>Implementation:</strong>
                        <ul>
                            <li>On login (and every 5 minutes), the addon queries the server for a full list of known
                                enchants.</li>
                            <li>These IDs are bulk-loaded into the <code>collectedCache</code>.</li>
                            <li>The filter now checks this cache directly, bypassing tooltip scanning entirely for known
                                enchants.</li>
                        </ul>
                    </li>
                </ul>
            </div>

            <div class="optimization-card">
                <h4>v0.7.48 - Viewer Crash Fix &amp; Gladdy Compatibility</h4>
                <ul>
                    <li>Fixed client crash when selecting "Special Vendors" (MSv) in Viewer</li>
                    <li>Resolved settings persistence issues caused by crashes</li>
                    <li>Added missing initialization for <code>msv</code> filter table</li>
                </ul>
            </div>

            <div class="optimization-card">
                <h4>v0.7.47.1 - PvP Death Chest False Positives Fix</h4>
                <ul>
                    <li>Implemented blacklist for "Unclaimed Belongings" and "Human Corpse" loot containers</li>
                    <li>Prevents PvP death chests from being incorrectly recorded as world discoveries</li>
                    <li>Fixed issue where opening a player's dropped loot would spawn a permanent map pin</li>
                </ul>
            </div>

            <div class="optimization-card">
                <h4>v0.7.47 - Astrolabe Integration for Smooth Minimap Rotation</h4>
                <ul>
                    <li>Integrated Astrolabe-0.4 library for automatic minimap icon positioning</li>
                    <li>Replaced ~80 lines of manual rotation code with <code>Astrolabe:PlaceIconOnMinimap()</code></li>
                    <li>Pins now rotate as smoothly as GatherMate pins</li>
                    <li>Added distance filtering to hide pins beyond <code>minimapRadius * 1.5</code></li>
                    <li>Increased ticker rate to 60 FPS for smoother updates</li>
                </ul>
            </div>

            <div class="optimization-card">
                <h4>v0.7.46 - Performance Optimizations Phase 3</h4>
                <ul>
                    <li>String Interning, Weak Table Caching, Batch Processing</li>
                    <li>New commands: <code>/lcstats</code>, <code>/lcbench</code></li>
                    <li><em>See detailed developer section above</em></li>
                </ul>
            </div>

            <div class="optimization-card">
                <h4>v0.7.45 - Mystic Scroll Looted Persistence Fix</h4>
                <ul>
                    <li>Fixed: Mystic Scrolls now correctly remain hidden after being looted</li>
                    <li>Extended dual-key tracking system to Mystic Scrolls (previously only Worldforged)</li>
                    <li>Looted Mystic Scrolls tracked by both GUID and <code>(itemID, zone)</code> key</li>
                    <li>Added automatic migration to backfill existing looted Mystic Scrolls</li>
                    <li>Zone-aware updates: On zone change, re-checks for looted scrolls to hide</li>
                </ul>
            </div>

            <div class="optimization-card">
                <h4>v0.7.44 - Worldforged Loot Persistence Fix</h4>
                <ul>
                    <li>Fixed: Worldforged items now correctly remain hidden after being looted</li>
                    <li>Looted Worldforged items tracked by both GUID and <code>(itemID, zone)</code> key</li>
                    <li>This ensures looted state persists when same item appears at new spawn location</li>
                </ul>
            </div>

            <div class="optimization-card">
                <h4>v0.7.43 - Performance Optimizations Phase 2</h4>
                <ul>
                    <li>Added <code>AcquireTable()</code>/<code>ReleaseTable()</code> table pool for GC reduction</li>
                    <li>Added <code>GetAdaptiveTimeBudget()</code> for FPS-based processing</li>
                    <li>Replaced 16 <code>table.insert()</code> calls with direct assignment</li>
                    <li>Added localized globals to Tooltip.lua</li>
                </ul>
            </div>

            <div class="optimization-card">
                <h4>v0.7.42 - Performance Optimizations Phase 1</h4>
                <ul>
                    <li>Added global function caching for <code>GetTime</code>, <code>math.*</code>,
                        <code>table.*</code>, <code>string.*</code>
                    </li>
                    <li>Replaced per-call table creation in <code>checkQueueForSpam()</code> with reusable table</li>
                    <li>Dispatcher frame now hides when idle and auto-wakes when work is added</li>
                    <li><code>updateTicker</code> frame hides when no data changes pending</li>
                    <li>Added wake calls at all <code>L.DataHasChanged = true</code> locations</li>
                </ul>
            </div>

            <div class="optimization-card">
                <h4>v0.7.41 - Frame Strata Fix</h4>
                <ul>
                    <li>Fixed Tooltip Visibility: Tooltips now display above map pins and overlays</li>
                    <li>Changed map pins, overlays, and hover buttons from <code>TOOLTIP</code> to <code>HIGH</code>
                        strata</li>
                    <li>Changed context menus and autocomplete dropdowns from <code>TOOLTIP</code> to
                        <code>DIALOG</code> strata
                    </li>
                </ul>
            </div>

            <div class="optimization-card">
                <h4>v0.7.40 - Fixes + Small Optimizations</h4>
                <ul>
                    <li>Fixed few bugs</li>
                    <li>Testing alternative solutions and optimizations</li>
                    <li>Added feature to disable Mystic Scrolls processing</li>
                    <li>Removed HistoryTab feature</li>
                </ul>
            </div>

            <p style="margin-top: 20px; color: var(--text-secondary);">See the full <a
                    href="https://github.com/Xurkon/LootCollector/blob/performance-tweaks/CHANGELOG.md"
                    style="color: var(--accent);">CHANGELOG.md</a> for complete version history.</p>
        </div>

        <div class="section">
            <h2>ðŸš€ Future Optimizations</h2>
            <p style="margin-bottom: 20px; color: var(--text-secondary);">Potential improvements that could be
                implemented in future versions.</p>

            <div class="optimization-card">
                <h4>Spatial Hashing for Minimap Pins <span
                        style="background: #4caf50; color: white; padding: 2px 8px; border-radius: 4px; font-size: 12px; margin-left: 8px;">IMPLEMENTED</span>
                </h4>
                <p style="color: var(--text-secondary); margin-bottom: 10px;"><strong>Benefit:</strong> Faster distance
                    calculations when many pins are visible. Currently O(n) for each update, could be O(1) average.</p>
                <p style="color: var(--text-secondary); margin-bottom: 10px;"><strong>Impact:</strong> High - especially
                    in zones with 50+ discoveries</p>
                <p style="color: var(--text-secondary);"><strong>Implementation:</strong></p>
                <pre
                    style="background: var(--code-bg); padding: 15px; border-radius: 6px; overflow-x: auto; margin: 10px 0;"><code>local GRID_SIZE = 0.05  -- ~5% of zone width
local function GetGridKey(x, y)
    return floor(x / GRID_SIZE) .. ":" .. floor(y / GRID_SIZE)
end
-- Only check pins in player's grid cell + adjacent cells</code></pre>
            </div>

            <div class="optimization-card">
                <h4>Lazy Viewer Row Creation <span
                        style="background: #9e9e9e; color: white; padding: 2px 8px; border-radius: 4px; font-size: 12px; margin-left: 8px;">SKIPPED</span>
                </h4>
                <p style="color: var(--text-secondary); margin-bottom: 10px;"><strong>Benefit:</strong> Faster addon
                    load time by delaying row frame creation until viewer is opened.</p>
                <p style="color: var(--text-secondary); margin-bottom: 10px;"><strong>Impact:</strong> Medium - reduces
                    initial memory footprint by ~50 frames</p>
                <p style="color: var(--text-secondary);"><strong>Implementation:</strong></p>
                <pre
                    style="background: var(--code-bg); padding: 15px; border-radius: 6px; overflow-x: auto; margin: 10px 0;"><code>-- Create only visible rows initially
-- Pool hidden rows for reuse when scrolling
-- Delay secondary frame creation until viewer first opened
local rowPool = {}
function Viewer:AcquireRow()
    return tremove(rowPool) or CreateRow()
end</code></pre>
            </div>

            <div class="optimization-card">
                <h4>String Interning for Item Links <span
                        style="background: #4caf50; color: white; padding: 2px 8px; border-radius: 4px; font-size: 12px; margin-left: 8px;">IMPLEMENTED</span>
                </h4>
                <p style="color: var(--text-secondary); margin-bottom: 10px;"><strong>Benefit:</strong> Reduced memory
                    usage by deduplicating repeated item link strings.</p>
                <p style="color: var(--text-secondary); margin-bottom: 10px;"><strong>Impact:</strong> Low-Medium -
                    saves ~20-50 bytes per duplicate link</p>
                <p style="color: var(--text-secondary);"><strong>Implementation:</strong></p>
                <pre
                    style="background: var(--code-bg); padding: 15px; border-radius: 6px; overflow-x: auto; margin: 10px 0;"><code>local linkIntern = setmetatable({}, {__mode = "v"})
local function InternLink(link)
    if not link then return nil end
    local cached = linkIntern[link]
    if cached then return cached end
    linkIntern[link] = link
    return link
end</code></pre>
            </div>

            <div class="optimization-card">
                <h4>Event Coalescing for Map Updates <span
                        style="background: #ff9800; color: white; padding: 2px 8px; border-radius: 4px; font-size: 12px; margin-left: 8px;">DEFERRED</span>
                </h4>
                <p style="color: var(--text-secondary); margin-bottom: 10px;"><strong>Benefit:</strong> Prevents
                    multiple rapid map redraws by batching updates within a time window.</p>
                <p style="color: var(--text-secondary); margin-bottom: 10px;"><strong>Impact:</strong> Medium - prevents
                    duplicate work during bulk operations</p>
                <p style="color: var(--text-secondary);"><strong>Implementation:</strong></p>
                <pre
                    style="background: var(--code-bg); padding: 15px; border-radius: 6px; overflow-x: auto; margin: 10px 0;"><code>local pendingMapUpdate = false
function Map:DeferredUpdate()
    if pendingMapUpdate then return end
    pendingMapUpdate = true
    C_Timer.After(0.1, function()
        pendingMapUpdate = false
        Map:Update()
    end)
end</code></pre>
            </div>

            <div class="optimization-card">
                <h4>Batch Processing with Coroutines <span
                        style="background: #4caf50; color: white; padding: 2px 8px; border-radius: 4px; font-size: 12px; margin-left: 8px;">IMPLEMENTED</span>
                </h4>
                <p style="color: var(--text-secondary); margin-bottom: 10px;"><strong>Benefit:</strong> Spread heavy
                    operations across multiple frames to prevent freezing.</p>
                <p style="color: var(--text-secondary); margin-bottom: 10px;"><strong>Impact:</strong> High - critical
                    for large database operations</p>
                <p style="color: var(--text-secondary);"><strong>Implementation:</strong></p>
                <pre
                    style="background: var(--code-bg); padding: 15px; border-radius: 6px; overflow-x: auto; margin: 10px 0;"><code>local function ProcessInChunks(items, processor, chunkSize)
    local co = coroutine.create(function()
        for i, item in ipairs(items) do
            processor(item)
            if i % chunkSize == 0 then
                coroutine.yield()
            end
        end
    end)
    -- Resume each frame via OnUpdate
end</code></pre>
            </div>

            <div class="optimization-card">
                <h4>Weak Table Caching for Tooltips <span
                        style="background: #4caf50; color: white; padding: 2px 8px; border-radius: 4px; font-size: 12px; margin-left: 8px;">IMPLEMENTED</span>
                </h4>
                <p style="color: var(--text-secondary); margin-bottom: 10px;"><strong>Benefit:</strong> Auto-clearing
                    cache that doesn't prevent garbage collection of unused entries.</p>
                <p style="color: var(--text-secondary); margin-bottom: 10px;"><strong>Impact:</strong> Low - minor
                    memory optimization</p>
                <p style="color: var(--text-secondary);"><strong>Implementation:</strong></p>
                <pre
                    style="background: var(--code-bg); padding: 15px; border-radius: 6px; overflow-x: auto; margin: 10px 0;"><code>-- Weak values allow GC to collect unused entries
local tooltipCache = setmetatable({}, {__mode = "v"})
function GetCachedTooltipData(itemID)
    if tooltipCache[itemID] then return tooltipCache[itemID] end
    local data = BuildTooltipData(itemID)
    tooltipCache[itemID] = data
    return data
end</code></pre>
            </div>
        </div>

        <div class="credit">
            <p>Original addon by <strong>Skulltrail</strong></p>
            <p>Performance optimizations by <strong>Xurkon</strong></p>
            <p><a href="https://github.com/mmobrain/LootCollector">View on GitHub</a></p>
        </div>
    </div>

    <footer>
        <p>LootCollector for Project Ascension (Bronzebeard)</p>
    </footer>
</body>

</html>